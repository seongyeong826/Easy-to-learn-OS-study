# 입출력 시스템과 저장장치

컴퓨터는 필수 장치인 CPU, 메모리와 주변장치인 입출력장치와 저장장치로 구분된다.

각 장치는 메인보드에 있는 버스로 연결되며 주변장치는 데이터 전송 속도에 따라 두 가지로 구분된다.

- 저속 주변장치 : 데이터 전송률이 낮은 주변장치 ex) 키보드
- 고속 주변장치 : 데이터 전송률이 높은 주변장치 ex) 그래픽카드, 하드디스크

<b>채널</b> : 데이터가 지나다니는 통로

- 채널을 모든 주변장치가 공유하면 데이터 전송속도가 느려진다.
- 전송 속도가 비슷한 장치끼리 묶어서 장치별로 채널을 할당하면 속도를 향상시킬 수 있다.

<br />

## 입출력 버스의 발전 구조

초기에는 주변장치가 많지 않았고 CPU와 메모리의 속도도 빠르지 않았다.그래서 모든 장치가 하나의 버스로 연결되었고 `폴링` 방식을 사용했다.

### 폴링(Polling)

- CPU가 작업을 수행하다 입출력 명령을 만나면 직접 입출력장치에서 데이터를 가져오는 것
- 폴링 방식을 사용하면 CPU는 입출력이 끝날때 까지 다른 작업을 할 수 없다.

<br />

기술의 발전으로 성능이 향상되고 주변장치가 다양해짐에 따라 CPU가 폴링 방식으로 처리하는게 아닌 모든 입출력을 `입출력 제어기(I/O controller)`에 맡기는 방식으로 바뀌었다.

### 입출력 제어기(I/O controller)

- 2개의 채널, 메인 버스와 입출력 버스로 나뉜다.
- 메인 버스는 고속으로 작동하는 CPU와 메모리가 사용
- 입출력 버스는 주변장치가 사용한다.
- 입출력장치를 사용하면 느린 입출력장치로 인해 CPU와 메모리의 작업이 느려지는 것을 막을 수 있어 전체 작업 효율이 향상된다.

<br />

## 입출력 버스의 분리

입출력 제어기를 사용하면 작업 효율을 높일 수 있지만, 저속 주변장치 떄문에 고속 주변장치의 데이터 전송이 느려질 수 있다.

이러한 문제를 해결하기 위해 입출력 버스를 고속 입출력 버스와 저속 입출력 버스로 분리하여 운영한다.

두 버스 사이의 데이터 전송은 채널 선택기가 관리한다.

<br />

### 그래픽카드의 분리

화면의 해상도가 높아지고 3D 게임이 보급되면서 그래픽카드가 계산해야 되는 양이 늘어남에 따라 그래픽카드에 GPU가 부착되었다.

GPU의 계산 능력과 다루는 데이터의 양은 고속 입출력 버스로 감당하기 어려워서 메인 버스와 직접 연결된 그래픽 버스를 사용하게 되었다.

<br />

![Untitled 3](https://user-images.githubusercontent.com/103870198/216004766-a98663d5-9dda-4488-a760-8f208c4e966c.png)

- 메인버스 : 고속으로 작동하는 CPU와 메모리가 사용
- 입출력 버스: 주변 장치가 사용
- 그래픽카드는 GPU 연산을 해야해서 AGP라는 전용 포트를 통해 메인버스에 바로 연결하여 사용

<br />

## 직접 메모리 접근(Direct Memory Access, DMA)

![Untitled 4](https://user-images.githubusercontent.com/103870198/216006626-2451ad65-c93f-4cf1-94f4-a8502ffafa7b.png)

- CPU의 도움 없이 메모리에 접근할 수 있도록 입출력 제어기에 부여된 권한
- 입출력 제어기에는 직접 메모리에 접근하기 위한 DMA 제어기가 있음
- 입출력 제어기는 여러 채널에 연결된 주변장치로부터 전송된 데이터를 적절히 배분하여 하나의 데이터 흐름을 만듬
- 채널 선택기는 여러 채널에서 전송된 데이터 중 어떤 것을 메모리로 보낼지 결정

### 메모리 맵 입출력(memory mapped I/O)

- 메모리 주소공간 중 일부를 DMA제어기에게 할당하여
  작업 공간이 겹치는 것을 막는것

<br />

## 입출력과 인터럽트

- 외부 인터럽트
  - 외부 인터럽트는 주변장치의 입출력 요구나 하드웨어 이상 현상을 CPU에게 알려주는 신호
  - 각 장치에는 IRQ라는 고유의 인터럽트 번호가 있음
- 내부 인터럽트
  - 내부 인터럽트는 숫자를 0으로 나누거나, 주소 공간을 벗어나 작업하는 것과 같이 프로세스의 오류와 관련된 인터럽트
  - 프로세스의 잘못이나 예기치 못한 상황 떄문에 발생하므로 _예외 상황(exception)_ 이라고도 한다.
- 시그널

  - 사용자가 직접 발생시키는 인터럽트

  <br />

## 인터럽트 벡터와 핸들러

![Untitled 5](https://user-images.githubusercontent.com/103870198/216008215-cf43b7cc-f3e9-459b-af62-78ff922d1e73.png)

인터럽트는 종류에 따른 인터럽트 번호를 가진다.

### 인터럽트 벡터

- 여러 인터럽트 중 어떤 인터럽트가 발생했는지 파악하기 위해 사용하는 자료구조
- 벡터 값이 1이면 인터럽트가 발생했다는 뜻

<br />

### 인터럽트 핸들러

- 인터럽트의 처리 방법을 함수로 만들어놓은 것
- 운영체제는 인터럽트가 발생하면 인터럽트 핸들러를 호출해서 처리함.
- 사용자 인터럽트인 시그널은 자신이 만들수도 있음

<br />

## 버퍼(Buffer)

![Untitled 6 (1)](https://user-images.githubusercontent.com/103870198/216010643-79a48a8f-7785-467a-b4ff-0ac9074c08e0.png)

- 속도가 다른 두 장치의 속도 차이를 완화하는 역할을 하는 저장 공간
- 주변장치 뿐 아니라 커널도 버퍼를 사용함
  - 커널이 입출력장치로 보내야 할 데이터를 버퍼에 담아두면 입출력 제어기가 입출력장치로 데이터 전송
- 이중 버퍼를 사용하여 하나는 데이터를 담는 용도, 하나는 데이터를 가져가는 용도로 쓰면 유용하다.

### 플러시(flush)

버퍼의 데이터를 저장장치로 강제로 옮기는 것.

- 버퍼가 다 차지 않으면 다 찰때까지 입출력 장치에 자료가 전송되지 않는데 이상태에서 저장장치를 제거하면 버퍼 안의 데이터가 저장되지 않는 문제 발생
- ex) 윈도우에서 USB 제거할때 _하드웨어 안전 제거_ 기능
- 위 기능을 사용하면 버퍼가 다 자치 않아도 강제로 버퍼의 내용이 저장장치로 옮겨지는데 이를 `flush` 라고 한다.

<br />
<br />

# 디스크 장치

## 하드디스크(Hard Disk Drive)

하드디스크는 _스핀들(spindle)_ 이라는 원통 축에 여러 개의 *플래터(platter)*가 달려 있다.

- 플래터

  - 표면에 자성체가 발려 있어 자기를 이용하여 0과 1의 데이터를 저장할 수 있다.
  - 표면이 N극이면 0, S극이면 1로 인식한다.
  - 양면으로 데이터를 저장한다.

- 섹터
  - 물리적인 개념, 하드디스크의 가장 작은 저장 단위
  - 하나의 섹터에는 한 덩어리의 데이터가 저장된다.
- 블록
  - 하드디스크와 컴퓨터 사이에 데이터를 전송하는 논리적인 저장 단위 중 가장 작은 단위
  - 블록은 여러개의 섹터로 구성되며, 윈도우에서는 클러스터 라고 한다.
  - 하드디스크에는 논리적 단위인 블록마다 주소가 배정된다.
  - 하드디스크 입장에선 섹터가 가장 작은 단위, 운영체제 입장에선 블록이 가장 작은 단위
- 트랙
  - 플래터에서 회전축을 중심으로 데이터가 기록되는 동심원, 동일한 동심원상에 있는 섹터의 집합
- 실린더
  - 여러개의 플래터에 있는 트랙의 집합을 실린더 라고 한다.
- 헤드
  - 하드디스크에 데이터를 읽거나 쓸때 읽기/쓰기 헤드를 사용한다.

### 하드디스크와 CD의 디스크 회전

- 각속도 일정 방식 (하드디스크)
  하드디스크의 플래터는 항상 일정한 속도로 회전하여 바깥쪽 트랙의 속도가 안쪽 트랙의 속도보다 훨씬 빠르다.

  - 장점: 디스크가 일정한 속도로 회전하기 때문에 구동 장치가 단순하고 조용하게 작동

  - 단점: 모든 트랙의 섹터 수가 같고 바깥쪽 섹터의 크기가 안쪽 섹터보다 커서 안쪽 트랙에 비해 바깥쪽 트랙으로 갈수록 낭비되는 공감이 생김

- 선속도 일정 방식 (CD)

  CD에 사용하는 선속도 일정 방식은 어느 트랙에서나 단위 시간 당 디스크의 이동 거리가 같다.

  - 장점: CD는 한정된 공간에 많은 데이터를 담을 수 있고 하드디스크처럼 바깥쪽 트랙의 섹터 공간이 낭비되는 문제가 없음

  - 단점: 소음이 심함

> 하드디스크에서 데이터 전송 시간 : 탐색 시간 + 회전 지연 시간 + 전송 시간

> 파티션 : 디스크를 논리적으로 분할하는 작업, 파티션 하나에 하나의 파일 시스템이 탑재

> 마운트 : 유닉스 운영체제에서 여러 개의 파티션을 하나로 통합하는 것

> 포매팅 : 디스크에 파일 시스템을 탑재하고 디스크 표면을 초기화하여 사용할 수 있는 형태로 만드는 작업

> 조각 모음 : 디스크에 조각이 많이 생기면 큰 파일이 여러 조각으로 나뉘어 저장되고 이를 읽으려면 시간이 오래 소요되니까 성능 저하가 됨 -> 조각모음으로 해결

> DAS(Direct Attached Storage) : 서버와 같은 컴퓨터에 직접 연결된 저장장치

> NAS(Network Attached Storage) : 저장장치를 LAN이나 WAN에 붙여서 사용하는 방식

> SAN(Storage Area Network) : 데이터 서버, 백업 서버, RAID 등의 장치를 네트워크로 묶고 데이터 접근을 위한 서버를 두는 형태

<br />
<br />

## 디스크 스케쥴링

사용할 데이터가 디스크 상에 여러 곳에 저장되어 있을 경우 데이터를 엑세스하기 위해 디스크 헤드가 움직이는 경로를 결정하는 기법

- FCFS 스케줄링(First Come, First Service disk scheduling)

  입출력 요청 대기 큐에 들어온 순서대로 서비스하는 방법

- SSTF 스케줄링(Shortest Seek Time First disk scheduling)

  탐색 거리가 가장 짧은 트랙의 요청을 먼저 서비스하는 방법

- 그 외 블록 SSTF, SCAN, C-SCAN, LOOK, C-LOOK, SLTF 스케줄링 등등..

<br />
<br />

# RAID(Redundant Array of Independent Disks)

자동으로 백업을 하고 장애가 발생하면 이를 복구하는 시스템으로 `레이드` 라고 읽는다.

<br />

## RAID 0(striping)

- 같은 규격의 디스크를 병렬로 연결하여 여러 개의 데이터를 여러 디스크에 동시에 저장하거나 가져올 수 있음
- 장애 발생시 데이터 복구 안됨

## RAID 1(mirroring)

- 하나의 데이터를 2개의 디스크에 나누어 저장하여 장애 시 백업 디스크로 활용
- 비용 증가, 같은 내용 두번 저장해서 속도 느림

## RAID 2

- 오류를 검출하는 기능이 없는 디스크에 대해 오류 교정 코드를 따로 관리하고, 오류가 발생하면 이 코드를 이용하여 디스크를 복구

## RAID 3

- 섹터 단위로 데이터를 나누어 저장
- 패리티 비트를 사용하여 데이터 복구

## RAID 4

- 블록 단위로 데이터를 나누어 저장
- 데이터가 저장되는 디스크와 패리티 비트가 저장되는 디스크만 동작한다는 장점

## RAID 5

- 패리티 비트를 여러 디스크에 분산하여 보관함으로써 패리티 비트 디스크의 병목 현상을 완화

## RAID 6

- 패리티 비트가 2개여서 디스크 2개의 장애 복구 가능

## RAID 01과 RAID 10

- RAID 01은 스트라이핑한 디스크를 서로 미러링
- RAID 10은 각각 미러링한 디스크를 스트라이핑

## RAID 50과 RAID 60

- RAID 50은 RAID 5로 묶은 두 쌍을 다시 RAID 0 으로 묶음
- RAID 60은 RAID 6으로 묶은 두 쌍을 다시 RAID 0으로 묶음

### SATA

- SATA

  Serial ATA의 약자로 인터페이스, 연결방식이다.

  SSD나 HDD 등을 메인보드에 연결하는데 사용하는 인터페이스(연결선)

  기존의 사용하던 병렬ATA(PATA)를 대체해서 나온 직렬 ATA가 SATA 이다.

  뒤에 붙는 3.0 6.0은 속도

### USB

- 다양한 주변장치를 연결할 수 있는 범용 포트
- 뒤에 붙는 숫자는 전송 속도

SATA와 USB의 차이는 USB는 내부에 전원 공급선이 있어서 기기에 전원을 공급하면서 데이터 전송 가능하지만 SATA는 데이터만 전송하는 단자이므로 전원 공급선을 따로 연결해야 한다.

### DVI와 HDMI

- DVI : 모니터 같은 디스플레이 장치에 최적화된 표준 영상 인터페이스
- HDMI : DVI는 모니터를 위한 단자이므로 사운드 단자를 따로 연결해야 하지만 HDMI는 비디오 신호와 오디오 신호를 하나의 단자로 구현하기 때문에 영상과 소리를 선 하나로 전송할 수 있어 편리하다.

<hr >

q1. DMA에 대해 설명해주세요

- DMA는 CPU의 도움 없이 메모리에 직접 접근할 수 있는 권한으로 I/O 컨트롤러안에 포함된 DMA 제어기를 통해 메모리에 직접 접근합니다.

q2. 인터럽트에 대해 설명해주시고 종류에 대해 설명해주세요

인터럽트는 CPU가 프로그램을 실행하고 있을 때 입출력 하드웨어 장치등의 문제 또는 프로세스 내부의 예외상황이 발생하여 처리가 필요할 경우 CPU에 알리는 것입니다.

인터럽트는 입출력 및 하드웨어 이상으로 발생하는 외부 인터럽트와

프로세스 내의 오류(숫자를 0으로 나눈다던가 등)으로 발생하는 내부 인터럽트가 있고

사용자의 요청에 의해 발생하는 시그널이 있습니다.

또한 인터럽트는 인터럽트의 처리 방법을 함수로 만들어 놓은 인터럽트 핸들러를 통해 인터럽트 발생 시 운영체제가 핸들러를 호출하여 작업합니다.

q3. 버퍼에 대해 설명해주세요

버퍼는 임시 저장 공간을 의미하는데 프로그래밍이나 OS에서 사용되는 버퍼는 대부분 CPU와 보조기억장치 사이에서 두 장치간의 속도차를 완화하기 위해 사용하는 임시 저장공간이라고 할 수 있습니다.

q4. RAID에 대해 설명해주세요
레이드는 자동으로 백업을 하고 장애가 발생하면 이를 복구하는 시스템을 말합니다.

주로 여러 개의 하드디스크에 중복된 데이터를 나누어 저장하는 기술을 뜻하며 백업본을 저장함으로써 안전성을 높이기 위해서 입니다.
레이드는 여러 종류의 레벨이 있는데 레벨이 높아질수록 신뢰성과 안정성도 높아집니다.

궁금한 점1 : NAS와 Cloud Storage는 무슨 차이 일까?

궁금한 점2 : SSD는 뭘까?

심심풀이 재밌는 퀴즈

![google](https://user-images.githubusercontent.com/103870198/216048656-2800277b-104d-49f8-a80e-463089803ffd.jpeg)
